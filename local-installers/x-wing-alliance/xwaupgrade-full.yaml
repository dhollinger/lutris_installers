name: "STAR WARS: X-Wing Alliance"
game_slug: star-wars-x-wing-alliance
version: GOG-XWAUP_beta
slug: star-wars-x-wing-alliance-gog-xwaup
runner: wine
gogid: 1421404763
gogslug: "star_wars_xwing_alliance"

script:
  files:
  # Download X-Wing Alliance
  - install: "N/A:Select the installer provided by GOG."
  # XWA Hacker resolution fixes
  - xwahacker: https://managedway.dl.sourceforge.net/project/xwahacker/xwahacker-3.2.zip
  # X-Wing Alliance Upgrade Project core installers
  - xwaucp: https://www.xwaupgrade.com/download/installers/XWAUCP_v1.6.exe
  - xwaucppatch: https://www.xwaupgrade.com/download/installers/XWAUCP_Patch_v1.0.exe
  # XWAUCP Ship packs
  - blastboat: https://www.xwaupgrade.com/download/models/SkiprayBlastboat_v2.2.exe
  - twing: https://www.xwaupgrade.com/download/models/Twing_v4.2.exe
  - vsd: https://www.xwaupgrade.com/download/models/VictoryStarDestroyer_v2.0.exe
  - vsd2: https://www.xwaupgrade.com/download/models/VictoryStarDestroyer2_v2.0.exe
  - isd2: https://www.xwaupgrade.com/download/models/ImperialStarDestroyer2_v2.0.exe
  - ssd: https://www.xwaupgrade.com/download/models/SuperStarDestroyer_v2.0.exe
  - irs: https://www.xwaupgrade.com/download/models/ImperialResearchShip_v1.2.exe
  - bulk: https://www.xwaupgrade.com/download/models/BulkCruiser_v1.1.exe
  - dread: https://www.xwaupgrade.com/download/models/Dreadnaught_v2.2.exe
  - nb2: https://www.xwaupgrade.com/download/models/ModFrigate_v2.1.exe
  - strike: https://www.xwaupgrade.com/download/models/StrikeCruiser_v2.2.exe
  - dunari: https://www.xwaupgrade.com/download/models/Casino_v2.0.exe
  - repair: https://www.xwaupgrade.com/download/models/RepairYard_v1.1.exe
  - array: https://www.xwaupgrade.com/download/models/SensorArray_v1.1.exe
  - shipyard: https://www.xwaupgrade.com/download/models/ShipYard_v1.0.exe
  - ashuttle: https://www.xwaupgrade.com/download/models/AssaultShuttle_v2.0.exe
  - atrans: https://www.xwaupgrade.com/download/models/AssaultTransport_v2.1.exe
  - cuv: https://www.xwaupgrade.com/download/models/CombatUtilityVehicle_v1.0.exe
  - yt1300: https://www.xwaupgrade.com/download/models/YT-1300_v2.1.exe
  - mf: https://www.xwaupgrade.com/download/models/MillenniumFalcon_v3.1.exe
  - yt2000: https://www.xwaupgrade.com/download/models/Otana_v2.2.exe
  - yt2400: https://www.xwaupgrade.com/download/models/Outrider_v3.2.exe
  - escort: https://www.xwaupgrade.com/download/models/EscortShuttle_v2.3.exe
  - shuttle: https://www.xwaupgrade.com/download/models/Shuttle_v5.2.exe
  - trans: https://www.xwaupgrade.com/download/models/StormTransport_v2.1.exe
  - conttrans: https://www.xwaupgrade.com/download/models/ContainerTransport_v2.3.exe
  - containers: https://www.xwaupgrade.com/download/models/ContainerPack_v4.1.exe
  - imppilot: https://www.xwaupgrade.com/download/models/ImperialPilot_v1.1.exe
  - accel: https://www.xwaupgrade.com/download/models/AccelRing_v1.1.exe
  - guns: https://www.xwaupgrade.com/download/models/GunPlatform_v2.2.exe
  - lguns: https://www.xwaupgrade.com/download/models/GunPads_v1.1.exe
  # Crew Quarters and Backdrops
  - crewquarters: https://www.xwaupgrade.com/download/installers/CrewQuarters_v1.1.exe
  - superbackdrops: https://www.xwaupgrade.com/download/installers/SuperBackdropsPatch_v3.1.exe
  # Effects and Dynamic Cockpits
  - effects: https://www.xwaupgrade.com/download/installers/EffectsByBlueMax_v1.1.4.exe
  - rebelcockpits: https://www.xwaupgrade.com/download/installers/RebelDynamicCockpits_v2.1.exe
  - tiecockpits: https://www.xwaupgrade.com/download/installers/TieDynamicCockpits_v2.0.exe
  - z95: https://www.xwaupgrade.com/download/models/Z-95Headhunter_v5.2.exe
  # Game execution
  game:
    arch: win64
    exe: drive_c/GOG Games/Star Wars - X-Wing Alliance/XWINGALLIANCE.EXE
    prefix: $GAMEDIR
  installer:
  # Create Prefix and setup .NET
  - task:
      arch: win64
      name: create_prefix
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing .NET 4.6.1
      name: winetricks
      prefix: $GAMEDIR
      app: dotnet461
  # Installing X-Wing Alliance
  - task:
      arch: win64
      description: Running installer. Please quit the installer at the end, do not run
        the game until this script finishes installing.
      executable: install
      name: wineexec
      prefix: $GAMEDIR
  # Installing XWA Upgrade Project Core
  - task:
      arch: win64
      description: Installing XWA Upgrade 1.6
      executable: xwaucp
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing XWA Upgrade Patch 1.0
      executable: xwaucppatch
      name: wineexec
      prefix: $GAMEDIR
  # Installing Starfighter and Capital Ship packs
  - task:
      arch: win64
      description: Installing Blastboat ship pack
      executable: blastboat
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing T-Wing ship pack
      executable: twing
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Victory-class Star Destroyer ship pack
      executable: vsd
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Victory II-class Star Destroyer ship pack
      executable: vsd2
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Imperial II-class Star Destroyer ship pack
      executable: isd2
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Executor-class Star Destroyer ship pack
      executable: ssd
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Imperial Research Ship shippack
      executable: irs
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Bulk Cruiser ship pack
      executable: bulk
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Dreadnaught-class Heavy Cruiser ship pack
      executable: dread
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Nebulon-B2 Frigate ship pack
      executable: nb2
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Strike Cruiser ship pack
      executable: strike
      name: wineexec
      prefix: $GAMEDIR
  # Installing Station Packs
  - task:
      arch: win64
      description: Installing Dunari's Rest station pack
      executable: dunari
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Repair Yard station pack
      executable: repair
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Sensor Array station pack
      executable: sensor
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Shipyard station pack
      executable: shipyard
      name: wineexec
      prefix: $GAMEDIR
  # Installing Transport and Shuttle packs
  - task:
      arch: win64
      description: Installing Assault Shuttle ship pack
      executable: ashuttle
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Assault Transport ship pack
      executable: atrans
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Combat Utility Vehicle ship pack
      executable: cuv
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Corellian YT-1300 Lt Freighter ship pack
      executable: yt1300
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Corellian YT-2000 Lt Freighter ship pack
      executable: yt2000
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Corellian YT-2400 Lt Freighter ship pack
      executable: yt2400
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Millennium Falcon ship pack
      executable: mf
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Escort Shuttle ship pack
      executable: escort
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Lambda-class Shuttle ship pack
      executable: shuttle
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Stormtrooper Transport ship pack
      executable: trans
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Container Transport ship pack
      executable: conttrans
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Containers pack
      executable: containers
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Imperial Pilot pack
      executable: imppilot
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Acceleration Ring pack
      executable: accel
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Gun Platform pack
      executable: guns
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Large Gun Platform pack
      executable: lguns
      name: wineexec
      prefix: $GAMEDIR
  # Installing Crew Quarters and Background upgrades
  - task:
      arch: win64
      description: Installing Crew Quarters Upgrade
      executable: crewquarters
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Super Backdrops v3
      executable: superbackdrops
      name: wineexec
      prefix: $GAMEDIR
  # Installing Effects and Dynamic Cockpits
  - task:
      arch: win64
      description: Installing BlueMax's Effects upgrade
      executable: effects
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Rebel Dynamic Cockpits
      executable: rebelcockpits
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing TIE Dynamic Cockpits
      executable: tiecockpits
      name: wineexec
      prefix: $GAMEDIR
  - task:
      arch: win64
      description: Installing Z-95 model and dyanmic cockpit
      executable: z95
      name: wineexec
      prefix: $GAMEDIR
  # Configuring ddraw
  - execute:
      description: Disabling Text2DRenderer due to performance impacts
      command: 'sed -i s/Text2DRendererEnabled\ =\ 1/Text2DRendererEnabled\ =\ 0/g $GAMEDIR/drive_c/GOG\ Games/Star\ Wars\ -\ X-Wing\ Alliance/ddraw.cfg'
  - execute:
      description: Disabling Radar2DRenderer due to performance impacts
      command: 'sed -i s/Radar2DRendererEnabled\ =\ 1/Radar2DRendererEnabled\ =\ 0/g $GAMEDIR/drive_c/GOG\ Games/Star\ Wars\ -\ X-Wing\ Alliance/ddraw.cfg'
  # XWAHacker Resolution fixes
  - extract:
      description: Prepare XWAHacker
      dst: $CACHE/xwahacker
      file: xwahacker
      format: zip
  - task:
      args: XWINGALLIANCE.EXE -c 0
      executable: $CACHE/xwahacker/xwahacker.exe
      name: wineexec
      prefix: $GAMEDIR
      working_dir: $GAMEDIR/drive_c/GOG Games/Star Wars - X-Wing Alliance/
  - task:
      args: XWINGALLIANCE.EXE -c 7
      executable: $CACHE/xwahacker/xwahacker.exe
      name: wineexec
      prefix: $GAMEDIR
      working_dir: $GAMEDIR/drive_c/GOG Games/Star Wars - X-Wing Alliance/
  - task:
      description: Set resolution, FoV, and HUD scaling
      args: XWINGALLIANCE.EXE -r 3 1920 1080 1.490000 97.33
      executable: $CACHE/xwahacker/xwahacker.exe
      name: wineexec
      prefix: $GAMEDIR
      working_dir: $GAMEDIR/drive_c/GOG Games/Star Wars - X-Wing Alliance/
  - task:
      arch: win64
      description: Setting Windows 10 mode
      name: winetricks
      prefix: $GAMEDIR
      app: win10
  wine:
    overrides:
      ddraw.dll: n, b
      dinput.dll: n, b
  system:
    env:
      DXVK_STATE_CACHE: '0'
    reset_desktop: true
